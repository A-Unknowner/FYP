<!DOCTYPE html>
<html lang="">

<head>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='result.css') }}">
    <title></title>

    <!-- Template Stylesheet -->
    <link href="../static/bootstrap/style.css" rel="stylesheet">


</head>


<body style="background-color: #dcdcdc">

    {{ five_star_list }}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<!-- Navbar start -->
<!-- JavaScript Libraries -->
<link rel="stylesheet" href="../static/loading.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<nav class="navbar navbar-expand-lg navbar-light shadow-sm py-3 py-lg-0 px-3 px-lg-0"
     style="background-color:white ;">
    <a href="/" class="navbar-brand ms-lg-3">
        <h3 class="display-10 m-0" style="color: #555;">
            <div class="web-title-long">餐廳評論分析<span>(RRACL)</span>
            </div>
            <div class="web-title-short"><span>RRACL</span></div>
        </h3>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <div class="navbar-nav ms-auto py-0">
            <a href="index.html" class="nav-item nav-link text-gray-555">首頁</a>
            <form class="nav-item nav-link " action="/search_list" method="POST">
                <input type="search" placeholder="搜尋餐廳" name="restaurant_name" aria-label="Search">
                <!-- <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
                <button class="btn btn-light" type="submit">搜尋</button>
            </form>
        </div>
    </div>
</nav>
<!-- Navbar end -->


<div class="container-fluid">
    <div class="row">

        <div class="col pt-5 ps-5">
            <div style="color:#555;font-family: 'Noto Sans','sans-serif'">
                <h2>{{ restaurant_name }} - 分析結果</h2>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">

        <div class="col-3 col-3 pt-2 ps-5 pe-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <h2><label style="color:#00873E;"><i class="fas fa-smile"></i></label> <label
                            style="color:#555;font-family: 'Noto Sans','sans-serif'">{{ total_positive_percentage }}%</label>
                    </h2>
                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><h5><b>正面評論總數: {{ overall_positive }}</b></h5></label>
                </div>
            </div>
        </div>

        <div class="col-3 col-3 pt-2 ps-5 pe-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <h2><label style="color:#de8d0b;"><i class="fas fa-meh"></i></label> <label
                            style="color:#555;font-family: 'Noto Sans','sans-serif'">{{ total_neutral_percentage }}%</label>
                    </h2>
                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><h5><b>中立評論總數: {{ overall_neutral }}</b></h5></label>
                </div>
            </div>
        </div>

        <div class="col-3 col-3 pt-2 ps-5 pe-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <h2><label style="color:#ad181f;"><i class="fas fa-frown"></i></label> <label
                            style="color:#555;font-family: 'Noto Sans','sans-serif'">{{ total_negative_percentage }}%</label>
                    </h2>
                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><h5><b>負面評論總數: {{ overall_negative }}</b></h5></label>
                </div>
            </div>
        </div>

        <div class="col-3 col-3 pt-2 ps-5 pe-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <h2><label style="color:#0b0b53;"><i class="fas fa-comments"></i></label> <label
                            style="color:#555;font-family: 'Noto Sans','sans-serif'">{{ datas["content"]|length }}</label>
                    </h2>
                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><h5><b>分析評論總數</b></h5>
                    </label>
                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">

                    <canvas id="locationPie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>位置評級總數</b></label>
                </div>

            </div>

        </div>
        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">

                    <canvas id="servicePie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>服務評級總數</b></label>
                </div>
            </div>

        </div>

        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                    <canvas id="pricePie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>價格評級總數</b></label>
                </div>
            </div>

        </div>


        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">

                    <canvas id="environmentPie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>環境評級總數</b></label>
                </div>
            </div>

        </div>

        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">

                    <canvas id="dishPie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>食物評級總數</b></label>
                </div>
            </div>

        </div>

        <div class="col-2 ps-5 pe-5">

            <div class="card mb-2">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center">

                    <canvas id="othersPie"></canvas>

                    <label style="color:#555;font-family: 'Noto Sans','sans-serif'"><b>其他評級總數</b></label>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-6 p-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <canvas id="aspectDoughnutChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-6 p-5">
            <div class="card mb-3">
                <div
                        class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow">
                    <canvas id="polarityBarChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>


    <!--   this part is the header/table head -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 ps-5 pe-5">
                <div class="card">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center shadow"
                        style="padding: 0">
                        <div class="row" style="width: 100%">
                            <div class="col-6">
                                <h1 style="color:#555;font-family: 'Noto Sans','sans-serif'">評論</h1>
                            </div>
                            <div class="col-6">
                                <h1 style="color:#555;font-family: 'Noto Sans','sans-serif'">分析</h1>
                            </div>
                        </div>
                    </div>
                </div>

                {% for i in range(datas["content"]|length) %}

                <!--   this part is the header/table head end here -->
                <div class="card">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center shadow">
                        <div class="row">
                            <div class="col-6">
                                {{ datas["content"][index_list[i]] }}
                            </div>
                            <div class="col-6 ps-5 pe-5 pt-5">

                                <div class="row" style="padding-bottom: 2%">
                                    <div
                                        class="card-body d-flex flex-column justify-content-center align-items-center shadow">
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col d-flex align-items-center justify-content-center">
                                                    <h4><label
                                                            style="color:#555;font-family: 'Noto Sans','sans-serif'">
                                                            評論評分： <label id="getstarscore_{{ i }}">{{
                                                                five_star_list[i][i] }}</label></label> </h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="padding-bottom: 5%">
                                    <div class="col" style="padding: 0%;">
                                        <button class="btn btn-gary" type="button" data-toggle="collapse"
                                            data-target="#collapse_{{ i }}" aria-expanded="false"
                                            aria-controls="collapse_{{ i }}" style="width: 100%">
                                            <label>詳情</label>
                                        </button>
                                        <div class="collapse" id="collapse_{{ i }}">
                                            <div class="card card-body">
                                                <div class="container-fluid">
                                                    <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                                                        <canvas id="commentBarChart{{ i }}"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {% with num_labels=five_star_list|length %}
    <script>
        var numLabels = {{ num_labels }};
        for (var i = 0; i < numLabels; i++) {
            var labelElement = document.querySelector('#getstarscore_'+ i);
            labelElement.innerHTML = getstarscorethenreturnstar(labelElement.innerHTML);
            console.log(getstarscorethenreturnstar(labelElement));
        }

        function getstarscorethenreturnstar(score){
            var stars = '';
            for (var i = 0; i < 5; i++) {
                if (i < score) {
                    stars += '<i class="fa fa-star" style="color: #FFD700;"></i>';
                } else {
                    stars += '<i class="fa fa-star"></i>';
                }
            }
            return stars;
        } 
    </script>
{% endwith %}




<!--  chart script -->
<script>

    var ctx = document.getElementById("polarityBarChart").getContext("2d");

    var data = {
        labels: ["位置", "服務", "價格", "環境", "食物", "其他"],
        // labels: ["Chocolate", "Vanilla", "Strawberry"],
        datasets: [
            {
                label: "總共",
                backgroundColor: "#124076",
                borderWidth: 3,
                data: {{ overall_aspect }}
            },
            {
                label: "正面",
                backgroundColor: "#7F9F80",
                borderWidth: 3,
                data: {{ positive_list }}
            },
            {
                label: "中立",
                backgroundColor: "#F9E897",
                borderWidth: 3,
                data: {{ neutral_list }}
            },

            {
                label: "負面",
                backgroundColor: "#FFC374",
                borderWidth: 3,
                data: {{ negative_list }}
            }
        ]
    };

    var myBarChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {


            title: {
                display: true,
                text: "每方面的分析"
            },

            barValueSpacing: 20,
            scales: {
                yAxes: [{
                    ticks: {
                        min: 0,
                    }
                }]
            }

        }
    });


    // Total Aspect Doughnut
    var xValues = [
        "位置", 
        "服務", 
        "價格",
        "環境", 
        "食物", 
        "其他"
    ];
    var test = '{{ datas }}';

    var yValues = {{ overall_aspect }};

    var barColors = [
        "#b91d47",
        "#00aba9",
        "#2b5797",
        "#e8c3b9",
        "#1e7145",
        ""
    ];

    new Chart("aspectDoughnutChart", {
        type: "doughnut",
        data: {
            labels: xValues,
            datasets: [{
                backgroundColor: barColors,
                data: yValues, borderWidth: 3
                
            }

            ]
        },
        options: {
            title: {
                display: true,
                text: "總共提及到的分析"
            }
        }
    });
    // Total Aspect Doughnut


    // Location
    var backgroundColor = ["#00873E", "#de8d0b", "#ad181f"];

    var xValues = ["正面", "中立", "負面"];

    var yValues = [
        {{ each_aspects_total_percent_list[0]["total_location_positive_percent"] }},

        {{ each_aspects_total_percent_list[0]["total_location_neutral_percent"] }},

        {{ each_aspects_total_percent_list[0]["total_location_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        locationPieSet = new Chart("locationPie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }
            },

        });

        locationPieSet.canvas.parentNode.style.height = '200px';
        locationPieSet.canvas.parentNode.style.width = '200px';

    } else {

        const location_canvas = document.getElementById("locationPie");
        const location_ctx = location_canvas.getContext("2d");
        location_ctx.font = "30px : let polarity = Noto Sans";
        // Not Available
        location_ctx.fillText("不適用", 10, 50);

    }
    ;


    // Service
    var yValues = [
        {{ each_aspects_total_percent_list[1]["total_service_positive_percent"] }},

        {{ each_aspects_total_percent_list[1]["total_service_neutral_percent"] }},

        {{ each_aspects_total_percent_list[1]["total_service_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        servicePieSet = new Chart("servicePie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},

                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }

            },

        });

        servicePieSet.canvas.parentNode.style.height = '200px';
        servicePieSet.canvas.parentNode.style.width = '200px';

    } else {

        const service_canvas = document.getElementById("servicePie");
        const service_ctx = service_canvas.getContext("2d");
        service_ctx.font = "30px : let polarity = Noto Sans";
        service_ctx.fillText("不適用", 10, 50);

    }

    // Price
    var yValues = [
        {{ each_aspects_total_percent_list[2]["total_price_positive_percent"] }},

        {{ each_aspects_total_percent_list[2]["total_price_neutral_percent"] }},

        {{ each_aspects_total_percent_list[2]["total_price_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        pricePieSet = new Chart("pricePie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }
            }
        });

        pricePieSet.canvas.parentNode.style.height = '200px';
        pricePieSet.canvas.parentNode.style.width = '200px';

    } else {

        const price_canvas = document.getElementById("pricePie");
        const price_ctx = price_canvas.getContext("2d");
        price_ctx.font = "30px : let polarity = Noto Sans";
        price_ctx.fillText("不適用", 10, 50);

    }

    // Environment
    var yValues = [
        {{ each_aspects_total_percent_list[3]["total_environment_positive_percent"] }},

        {{ each_aspects_total_percent_list[3]["total_environment_neutral_percent"] }},

        {{ each_aspects_total_percent_list[3]["total_environment_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        environmentPieSet = new Chart("environmentPie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }
            }
        });

        environmentPieSet.canvas.parentNode.style.height = '200px';
        environmentPieSet.canvas.parentNode.style.width = '200px';

    } else {

        const environment_canvas = document.getElementById("environmentPie");
        const environment_ctx = environment_canvas.getContext("2d");
        environment_ctx.font = "30px : let polarity = Noto Sans";
        environment_ctx.fillText("不適用", 10, 50);

    }

    // Dish
    var yValues = [
        {{ each_aspects_total_percent_list[4]["total_dish_positive_percent"] }},

        {{ each_aspects_total_percent_list[4]["total_dish_neutral_percent"] }},

        {{ each_aspects_total_percent_list[4]["total_dish_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        dishPieSet = new Chart("dishPie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }
            }
        });

        dishPieSet.canvas.parentNode.style.height = '200px';
        dishPieSet.canvas.parentNode.style.width = '200px';

    } else {

        const dish_canvas = document.getElementById("dishPie");
        const dish_ctx = dish_canvas.getContext("2d");
        dish_ctx.font = "30px : let polarity = Noto Sans";
        dish_ctx.fillText("不適用", 10, 50);

    }


    // Others
    var yValues = [
        {{ each_aspects_total_percent_list[5]["total_others_positive_percent"] }},

        {{ each_aspects_total_percent_list[5]["total_others_neutral_percent"] }},

        {{ each_aspects_total_percent_list[5]["total_others_negative_percent"] }}
    ];

    if (yValues.reduce((a, b) => a + b, 0) != 0) {

        othersPieSet = new Chart("othersPie", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                    backgroundColor,
                    data: yValues, borderWidth: 3
                }

                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {display: false},
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var allData = data.datasets[tooltipItem.datasetIndex].data;
                            var tooltipLabel = data.labels[tooltipItem.index];
                            var tooltipData = allData[tooltipItem.index];
                            var total = 0;
                            for (var i in allData) {
                                total += allData[i];
                            }

                            return tooltipLabel + ': ' + tooltipData + '%';
                        }
                    }
                }
            }
        });

        othersPieSet.canvas.parentNode.style.height = '200px';
        othersPieSet.canvas.parentNode.style.width = '200px';

    } else {

        const others_canvas = document.getElementById("othersPie");
        const others_ctx = others_canvas.getContext("2d");
        others_ctx.font = "30px : let polarity = Noto Sans";
        others_ctx.fillText("不適用", 10, 50);

    }


</script>
<!--  chart script -->


<!-- comment chart -->

<script>

    for (let i = 0; i < {{ id_length }}; i++) {

        var location_traffic_convenience_data = [0, 0, 0, 0, 0, 0];
        var location_distance_from_business_district_data = [0, 0, 0, 0, 0, 0];
        var location_easy_to_find_data = [0, 0, 0, 0, 0, 0];

        var service_wait_time_data = [0, 0, 0, 0, 0, 0];
        var service_waiters_attitude_data = [0, 0, 0, 0, 0, 0];
        var service_parking_convenience_data = [0, 0, 0, 0, 0, 0];
        var service_serving_speed_data = [0, 0, 0, 0, 0, 0];

        var price_level_data = [0, 0, 0, 0, 0, 0];
        var price_cost_effective_data = [0, 0, 0, 0, 0, 0];
        var price_discount_data = [0, 0, 0, 0, 0, 0];

        var environment_decoration_data = [0, 0, 0, 0, 0, 0];
        var environment_noise_data = [0, 0, 0, 0, 0, 0];
        var environment_space_data = [0, 0, 0, 0, 0, 0];
        var environment_cleaness_data = [0, 0, 0, 0, 0, 0];

        var dish_portion_data = [0, 0, 0, 0, 0, 0];
        var dish_taste_data = [0, 0, 0, 0, 0, 0];
        var dish_look_data = [0, 0, 0, 0, 0, 0];
        var dish_recommendation_data = [0, 0, 0, 0, 0, 0];

        var others_overall_experience_data = [0, 0, 0, 0, 0, 0];
        var others_willing_to_consume_again_data = [0, 0, 0, 0, 0, 0];

        if ({{ location_traffic_convenience_list }}[i] != -2) {
            location_traffic_convenience_data = [1, 0, 0, 0, 0, 0]
        }
        ;
        if ({{ location_distance_from_business_district_list }}[i] != -2) {
            location_distance_from_business_district_data = [1, 0, 0, 0, 0, 0]
        }
        ;
        if ({{ location_easy_to_find_list }}[i] != -2) {
            location_easy_to_find_data = [1, 0, 0, 0, 0, 0]
        }
        ;

        if ({{ service_wait_time_list }}[i] != -2) {
            service_wait_time_data = [0, 1, 0, 0, 0, 0]
        }
        ;
        if ({{ service_waiters_attitude_list }}[i] != -2) {
            service_waiters_attitude_data = [0, 1, 0, 0, 0, 0]
        }
        ;
        if ({{ service_parking_convenience_list }}[i] != -2) {
            service_parking_convenience_data = [0, 1, 0, 0, 0, 0]
        }
        ;
        if ({{ service_serving_speed_list }}[i] != -2) {
            service_serving_speed_data = [0, 1, 0, 0, 0, 0]
        }
        ;

        if ({{ price_level_list }}[i] != -2) {
            price_level_data = [0, 0, 1, 0, 0, 0]
        }
        ;
        if ({{ price_cost_effective_list }}[i] != -2) {
            price_cost_effective_data = [0, 0, 1, 0, 0, 0]
        }
        ;
        if ({{ price_discount_list }}[i] != -2) {
            price_discount_data = [0, 0, 1, 0, 0, 0]
        }
        ;

        if ({{ environment_decoration_list }}[i] != -2) {
            environment_decoration_data = [0, 0, 0, 1, 0, 0]
        }
        ;
        if ({{ environment_noise_list }}[i] != -2) {
            environment_noise_data = [0, 0, 0, 1, 0, 0]
        }
        ;
        if ({{ environment_space_list }}[i] != -2) {
            environment_space_data = [0, 0, 0, 1, 0, 0]
        }
        ;
        if ({{ environment_cleaness_list }}[i] != -2) {
            environment_cleaness_data = [0, 0, 0, 1, 0, 0]
        }
        ;

        if ({{ dish_portion_list }}[i] != -2) {
            dish_portion_data = [0, 0, 0, 0, 1, 0]
        }
        ;
        if ({{ dish_taste_list }}[i] != -2) {
            dish_taste_data = [0, 0, 0, 0, 1, 0]
        }
        ;
        if ({{ dish_look_list }}[i] != -2) {
            dish_look_data = [0, 0, 0, 0, 1, 0]
        }
        ;
        if ({{ dish_recommendation_list }}[i] != -2) {
            dish_recommendation_data = [0, 0, 0, 0, 1, 0]
        }
        ;

        if ({{ others_overall_experience_list }}[i] != -2) {
            others_overall_experience_data = [0, 0, 0, 0, 0, 1]
        }
        ;
        if ({{ others_willing_to_consume_again_list }}[i] != -2) {
            others_willing_to_consume_again_data = [0, 0, 0, 0, 0, 1]
        }
        ;

        datasets = [

            ////////////// location
            { label: 'location_traffic_convenience', data: location_traffic_convenience_data, backgroundColor: '#003C43', barPercentage: 0.5,  borderWidth: 3},
            { label: 'location_distance_from_business_district', data: location_distance_from_business_district_data, backgroundColor: '#135D66', barPercentage: 0.5,  borderWidth: 3},
            { label: 'location_easy_to_find', data: location_easy_to_find_data, backgroundColor: '#77B0AA', barPercentage: 0.5,  borderWidth: 3},

            ////////////// service
            { label: 'service_wait_time', data: service_wait_time_data, backgroundColor: '#164863', barPercentage: 0.5,  borderWidth: 3},
            { label: 'service_waiters_attitude', data: service_waiters_attitude_data, backgroundColor: '#427D9D', barPercentage: 0.5,  borderWidth: 3},
            { label: 'service_parking_convenience', data: service_parking_convenience_data, backgroundColor: '#9BBEC8', barPercentage: 0.5,  borderWidth: 3},
            { label: 'service_serving_speed', data: service_serving_speed_data, backgroundColor: '#DDF2FD', barPercentage: 0.5,  borderWidth: 3},

            ////////////// price
            { label: 'price_level', data: price_level_data, backgroundColor: '#00A9FF', barPercentage: 0.5,  borderWidth: 3},
            { label: 'price_cost_effective', data: price_cost_effective_data, backgroundColor: '#89CFF3', barPercentage: 0.5,  borderWidth: 3},
            { label: 'price_discount', data: price_discount_data, backgroundColor: '#A0E9FF', barPercentage: 0.5,  borderWidth: 3},

            ////////////// environment
            { label: 'environment_decoration', data: environment_decoration_data, backgroundColor: '#4A55A2', barPercentage: 0.5,  borderWidth: 3},
            { label: 'environment_noise', data: environment_noise_data, backgroundColor: '#7895CB', barPercentage: 0.5,  borderWidth: 3},
            { label: 'environment_space', data: environment_space_data, backgroundColor: '#A0BFE0', barPercentage: 0.5,  borderWidth: 3},
            { label: 'environment_cleaness', data: environment_cleaness_data, backgroundColor: '#C5DFF8', barPercentage: 0.5,  borderWidth: 3},

            ////////////// dish
            { label: 'dish_portion', data: dish_portion_data, backgroundColor: '#27374D', barPercentage: 0.5,  borderWidth: 3},
            { label: 'dish_taste', data: dish_taste_data, backgroundColor: '#526D82', barPercentage: 0.5,  borderWidth: 3},
            { label: 'dish_look', data: dish_look_data, backgroundColor: '#9DB2BF', barPercentage: 0.5,  borderWidth: 3},
            { label: 'dish_recommendation', data: dish_recommendation_data, backgroundColor: '#DDE6ED', barPercentage: 0.5,  borderWidth: 3},

            ////////////// others
            { label: 'others_overall_experience', data: others_overall_experience_data, backgroundColor: '#C4DDFF', barPercentage: 0.5,  borderWidth: 3},
            { label: 'others_willing_to_consume_again', data: others_willing_to_consume_again_data, backgroundColor: '#7FB5FF', barPercentage: 0.5,  borderWidth: 3}

        ]

        var ctx = document.getElementById("commentBarChart" + i.toString()).getContext('2d');

        var comment_chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['位置', '服務', "價格", "環境", "食物", "其他"],
                datasets: datasets
            },
            options: {
                responsive: true,
                legend: {display: false},
                scales: {
                    xAxes: [{stacked: true}],
                    yAxes: [{stacked: true, display:false}],

                },

                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            function setPolarity(hover_label, index_num) {

                                // the dictionary value store the bar name
                                aspect_name_dict = {
                                    "location_traffic_convenience": "交通是否便利",
                                    "location_distance_from_business_district": "距離商業區遠近",
                                    "location_easy_to_find": "餐廳是否容易尋找",

                                    "service_wait_time": "排隊等候時間",
                                    "service_waiters_attitude": "服務人員態度",
                                    "service_parking_convenience": "是否容易泊車",
                                    "service_serving_speed": "點菜/上菜速度",

                                    "price_level": "價格水平",
                                    "price_cost_effective": "性價比",
                                    "price_discount": "折扣力度",

                                    "environment_decoration": "裝修狀況",
                                    "environment_noise": "噪音狀況",
                                    "environment_space": "用餐空間",
                                    "environment_cleaness": "衛生狀況",

                                    "dish_portion": "食物分量",
                                    "dish_taste": "食物口感/味道",
                                    "dish_look": "食物外觀",
                                    "dish_recommendation": "食物推薦程度",

                                    "others_overall_experience": "本次消費感受",
                                    "others_willing_to_consume_again": "再次消費的意願"

                                }
                                if (hover_label == "location_traffic_convenience") {
                                    switch ({{ location_traffic_convenience_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }

                                }

                                if (hover_label == "location_distance_from_business_district") {
                                    switch ({{ location_distance_from_business_district_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "location_easy_to_find") {
                                    switch ({{ location_easy_to_find_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }

                                }

                                if (hover_label == "service_wait_time") {
                                    switch ({{ service_wait_time_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "service_waiters_attitude") {
                                    switch ({{ service_waiters_attitude_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "service_parking_convenience") {
                                    switch ({{ service_parking_convenience_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "service_serving_speed") {
                                    switch ({{ service_serving_speed_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "price_level") {
                                    switch ({{ price_level_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "price_cost_effective") {
                                    switch ({{ price_cost_effective_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "price_discount") {
                                    switch ({{ price_discount_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "environment_decoration") {
                                    switch ({{ environment_decoration_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "environment_noise") {
                                    switch ({{ environment_noise_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }

                                }

                                if (hover_label == "environment_space") {
                                    switch ({{ environment_space_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "environment_cleaness") {
                                    switch ({{ environment_cleaness_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "dish_portion") {
                                    switch ({{ dish_portion_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "dish_taste") {
                                    switch ({{ dish_taste_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "dish_look") {
                                    switch ({{ dish_look_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }

                                }

                                if (hover_label == "dish_recommendation") {
                                    switch ({{ dish_recommendation_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "others_overall_experience") {
                                    switch ({{ others_overall_experience_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                if (hover_label == "others_willing_to_consume_again") {
                                    switch ({{ others_willing_to_consume_again_list }}[index_num]) {
                                        case 1:
                                            var polarity = "正面";
                                            break;
                                        case 0:
                                            var polarity = "中立";
                                            break;
                                        case -1:
                                            var polarity = "負面";
                                            break;
                                        default:
                                            var polarity = "不適用";
                                            break;
                                    }
                                }

                                return `${aspect_name_dict[hover_label]} (${polarity})`;

                            }

                            var hover_label = data.datasets[tooltipItem.datasetIndex].label;

                            new_label = setPolarity(hover_label, i);

                            return new_label;

                        }
                    }

                }
            }
        });
    };

</script>
<!-- comment chart -->

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"
        integrity="sha512-+vZzLQZVJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7jZzJ7zv7g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>

</html>
